<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" href="./css/detailMovie.css" />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Playwrite+DE+Grund:wght@100..400&display=swap"
      rel="stylesheet"
    />

    <title>Document</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script>
      const GENRE_MAP = {
        35: '코미디',
        53: '스릴러',
        28: '액션',
        10749: '로맨스',
        18: '드라마',
        12: '어드밴쳐',
        16: '애니메이션',
        80: '범죄',
        99: '다큐멘터리',
        10751: '가족',
        14: '판타지',
        36: '역사',
        27: '호러',
        10402: '음악',
        9648: '미스테리',
        878: '공상 과학',
        10770: 'TV 영화',
        10752: '전쟁',
        37: '서양',
      };

      $(document).ready(function () {
        const searchId = new URLSearchParams(window.location.search);
        const movieId = searchId.get('movieId');

        $.ajax({
          url: 'fetch_movies.php',
          method: 'GET',
          dataType: 'json',
          success: function (data) {
            // 데이터가 있는지 확인
            if (data.results && data.results.length > 0) {
              // movieId에 해당하는 영화를 필터링
              const filteredMovie = data.results.find(
                (movie) => movie.id === parseInt(movieId, 10)
              );

              const genreNames = filteredMovie.genre_ids
                .map((id) => GENRE_MAP[id] || '알 수 없는 장르')
                .join(', ');

              // 영화가 존재하면 출력
              if (filteredMovie) {
                let output = ``;
                output += `
                <div class="detail">
                  <div class="moviePic">
                      <img src="https://image.tmdb.org/t/p/w500${filteredMovie.poster_path}" alt="${filteredMovie.title}">
                  </div>

                  <div class="contents">
                    <div class="contents1">
                      <div class="theme"><h3>${filteredMovie.title}</h3></div>
                      <div class="summary"><p>${filteredMovie.overview}</p></div>
                    </div>

                    <div class="contents2">
                      <div class="genre"><b>장르:&nbsp;</b> ${genreNames}</div>
                      <div class="date"><b>개봉일:&nbsp;</b> ${filteredMovie.release_date}</div>
                      <div class="rate"><span><b>평점:&nbsp;</b> ${filteredMovie.vote_average}</span></div>
                    </div>
                  </div>
                </div>
                `;

                $('body').css({
                  backgroundImage: `
                  linear-gradient(
                    to right,
                    rgba(20, 20, 20, 0.8) 20%,
                    rgba(20, 20, 20, 0.6) 40%,
                    rgba(20, 20, 20, 0.4) 60%,
                    rgba(20, 20, 20, 0.2) 80%,
                    rgba(20, 20, 20, 0) 100%
                  ),
                  url('https://image.tmdb.org/t/p/w1280${filteredMovie.backdrop_path}')
                `,
                  backgroundSize: 'cover',
                  backgroundPosition: 'center',
                });
                $('#result').html(output);
              } else {
                $('#result').html('<p>영화 데이터를 찾을 수 없습니다.</p>');
              }
            } else {
              $('#result').html('<p>영화 데이터를 찾을 수 없습니다.</p>');
            }
          },
          error: function () {
            $('#result').html('<p>영화를 가져오는 데 실패했습니다.</p>');
          },
        });

        $('#home').click(function () {
          window.location.href = 'index.html';
        });
      });
    </script>
  </head>
  <body>
    <h1 class="main-title" id="home">Guro 영화 사이트</h1>
    <div id="result"></div>
  </body>
</html>
